{% load widget_tweaks %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Settings</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
    <link rel="manifest" href="{% static 'site.webmanifest' %}">
    <link rel="stylesheet" href="{% static 'css/general.css' %}">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/settings.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.css">
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.png' %}">
    <script src="{% static 'js/p5.js' %}"></script>
    <script src="{% static 'js/p5.sound.js' %}"></script>
    <script src="{% static 'js/publicTracks.js' %}"></script>
</head>

<body>

<div class="settings-container">
    <p class="edit-heading">Click To Edit</p>

    <form action="" enctype="multipart/form-data" id="settings-form" class="settings-form">
        {% csrf_token %}
        {% render_field form.profileimg class+="settings-pfp" %}
        <label for="id_profileimg" class="image-container" id="image-box">
            <img src="{{ user_profile.profileimg.url }}" id="image-box" class="public-block"
                 style="width: 100%; filter: brightness(75%)">

            {% render_field form.name class+="settings-name" %}

            <div class="bio-and-music-block" id="bio-text">
                {% render_field form.bio class+="settings-bio" rows="auto" cols="auto" %}


                <div id="vis-container" style="height: 100%; width: 50%;">
                    {% if user_profile.fav_proj %}
                        <img src="/media/waveform.png" style="height: 110%; position: absolute; right: 0;">
                        {% else %}
                        <p>no project selected</p>
                    {% endif %}
                </div>


            </div>
        </label>
    </form>

    <button id="confirm-btn" style="display: none;"></button>
    <label for="confirm-btn" class="thin-block save-changes">Save Changes</label>

    <a href="{% url 'logout' %}?next=/signin" class="thin-block log-out">
        <p>Log Out</p>
        <img src="media/threelines.png" style="height: 20px; aspect-ratio: auto;"></a>

</div>
<footer>
    <nav style="grid-template-columns: 1fr 1fr 1fr;">

        <div class="header-text-container">
            <a href="/" class="navbar-text" style="font-size: 18px;">
                <img src="/media/Browse_grey.png" style="height: 35px">
            </a>
        </div>

        <div class="header-text-container">
            <a href="/create" class="navbar-text" style="font-size: 30px; color: #ffffff;">
                <img src="/media/Create_grey.png" style="height: 35px">
            </a>
        </div>

        <div class="header-text-container">
            <a href="/settings" class="navbar-text">
                <img src="/media/Drop_white.png" style="height: 35px">
            </a>
        </div>
    </nav>
</footer>
<script>
    function adjustTextareaFontSize(textareaId) {
        const textarea = document.getElementById(textareaId);
        let fontSize = parseInt(window.getComputedStyle(textarea).fontSize);

        // Function to adjust the font size
        const adjust = () => {
            // Reset font size and check if the textarea is overflowing
            textarea.style.fontSize = `${fontSize}px`;
            const isOverflowing = textarea.scrollHeight > textarea.clientHeight || textarea.scrollWidth > textarea.clientWidth;

            // Decrease font size if overflowing
            while (isOverflowing && fontSize > 1) {
                fontSize--;
                textarea.style.fontSize = `${fontSize}px`;
            }
        };

        // Initial adjust
        adjust();

        // Adjust on input
        textarea.addEventListener('input', adjust);
    }

    // Call the function with the ID of your textarea
    document.addEventListener('DOMContentLoaded', adjustFontSize('id_bio'));

</script>
<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<!-- cropper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

<!-- static -->
<script src="{% static 'js/settings.js' %}"></script>

</body>
</html>